# ![StructureOne Logo](/core/github_save/StructureOne.jpeg)



<p align="center">
  <img src="https://img.shields.io/badge/Version-2.1.1+-blueviolet?style=for-the-badge&logo=github" />
  <img src="https://img.shields.io/badge/PHP-7.4%2B-777BB4?style=for-the-badge&logo=php" />
  <img src="https://img.shields.io/badge/MySQL-8.0%2B-4479A1?style=for-the-badge&logo=mysql" />
  <img src="https://img.shields.io/badge/License-MIT-success?style=for-the-badge&logo=open-source-initiative" />
  <img src="https://img.shields.io/badge/API-RESTful-FF6B6B?style=for-the-badge&logo=postman" />
  <img src="https://img.shields.io/badge/Security-JWT-32CD32?style=for-the-badge&logo=auth0" />
  <img src="https://img.shields.io/badge/üèÜ-Meilleur%20Mini%20Framework%20API-orange?style=for-the-badge" />
  <img src="https://img.shields.io/badge/üî•-Class√©%20N¬∞1%20des%20MicroFrameworks-critical?style=for-the-badge" />
</p>

<p align="center"><img src="https://trendshift.io/api/badge/repositories/13425" alt="Trendshift" style="width: 250px; height: 55px;" width="250" height="55"/></p>


---

## üöÄ Introduction

**StructureOne** est une architecture PHP moderne et universelle, con√ßue pour √™tre **compatible avec n‚Äôimporte quel serveur**, que ce soit **Apache ou Nginx**.  
Gr√¢ce √† sa nouvelle conception, le framework d√©tecte automatiquement l‚Äôenvironnement serveur et s‚Äôadapte sans configuration manuelle.
Cette compatibilit√© universelle a √©t√© d√©velopp√©e pour garantir une **installation fluide, rapide et s√©curis√©e**, quel que soit l‚Äôh√©bergeur ou l‚Äôenvironnement.

---

## ‚ú® Fonctionnalit√©s Cl√©s

- üîß **Versioning d'API** : support natif pour `/api/v1/`, `/api/v2/`  
- üß† **Compatibilit√© multi-serveurs** : Apache & Nginx  
- üõ°Ô∏è **S√©curit√© avanc√©e** : protection automatique des fichiers sensibles  
- üß© **Support Composer** : StructureOne a √©t√© con√ßue pour √™tre compatible avec Composer 
- üß∞ **Gestion des erreurs et du debug** int√©gr√©e  
- ‚ôªÔ∏è **R√©trocompatibilit√© garantie** avec les versions pr√©c√©dentes  
- üé® **Interface HTML styl√©e** : Pages d'erreur et d'accueil professionnelles (comme Laravel/Symfony)
- ‚ö° **Variables automatiques** : Partage automatique entre fichiers, sans besoin de `global`
- üìù **Logging avanc√©** : Tra√ßabilit√© compl√®te avec timestamps

StructureOne vise √† √©voluer continuellement. Pour les utilisateurs en production, chaque mise √† jour restera compatible avec vos versions pr√©c√©dentes, sauf correctifs de s√©curit√© critiques.


---

## üìÇ Structure du projet

LLe projet est composer de plusieurs fichiers :

```
my-project/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ routes/         # API route handlers
‚îÇ   ‚îú‚îÄ‚îÄ database/       # Database migrations and seeds
‚îÇ   ‚îú‚îÄ‚îÄ logs/           # Application logs
‚îÇ   ‚îú‚îÄ‚îÄ versions/       # API route avec versions
‚îÇ   ‚îú‚îÄ‚îÄ cache/          # Cache files
‚îÇ   ‚îî‚îÄ‚îÄ uploads/        # Uploaded files
‚îú‚îÄ‚îÄ vendor              # Les dependances au cas ou vous utilisez composer
‚îú‚îÄ‚îÄ .env                # Environment variables
‚îú‚îÄ‚îÄ .htaccess           # La configuration serveur Apache
‚îú‚îÄ‚îÄ index.php           # Le routeur
‚îú‚îÄ‚îÄ config.php          # Les configuartions manuelle
‚îú‚îÄ‚îÄ laoder.php          # Toute les fonctions globaux
```

### Fichiers :

- **index.php**  
  G√®re dynamiquement les routes.  
  Ajoutez simplement un dossier dans `/core/routes/NOM_DU_DOSSIER` et le syst√®me appellera automatiquement son code pour g√©rer la route.  
  ‚ûù Aucun besoin de modifier ce fichier.
  ‚ûù Peut desormais prendre en charge des API par version depuis le dossier `/core/versions/v1/NOM_DU_DOSSIER` , la meme logique est garder.

- **config.php**  
  Contient toutes les **configurations globales** et importantes.  
  Utilisez **des constantes** plut√¥t que des variables afin d‚Äô√©viter des conflits.

- **loader.php**  
  Contient toutes les **fonctions globales**.  
  ‚ûù Ajoutez ici vos nouvelles fonctions r√©utilisables (connexion BDD, helpers, etc.).  
  ‚ö†Ô∏è Ne supprimez pas les fonctions par d√©faut sauf en cas de n√©cessit√©.

- **install.py** et **install.js**  
  Scripts d‚Äôinstallation du projet (au choix Python ou Node.js).  
  Une fois l‚Äôinstallation termin√©e, vous pouvez supprimer ces fichiers.

- **.htaccess** ,  **.env** et **nginx.conf.example**  
  - `nginx.conf.example` ‚Üí Crucial car il est le fichier d'example pour la configuration Nginx
  - `.htaccess` ‚Üí Crucial pour la r√©√©criture d‚ÄôURL et la redirection des requ√™tes vers le routeur.  
  - `.env` ‚Üí G√©n√©r√© automatiquement lors de l‚Äôinstallation (contient les configurations sensibles).  

Par defaut vous n'eetes pas obliger d'ajouter la configuration Nginx sauf si cela vous est utile.

> Pour eviter d'exposer votre fichier d'environnement , veuillez ouvrir le fichier du routeur (index.php) puis allez a la ligne 107 , mettez le chemin vers votre nouvelle emplacement du fichier .env

### Dossier `/core/` :

- **/routes/** ‚Üí Contient les dossiers de chaque route API.  
- **/versions** ‚Üí Contient les dossiers par versions des routes , `/versions/NOM_DE_LA_VERSIO/NOM_DE_LA_ROUTE` (ex : `/versions/v1/users_info`)
- **/logs/** ‚Üí Stockage des logs (erreurs, succ√®s, monitoring).  
- **/database/** ‚Üí Contient les fichiers `.sql` ou `.bdd`.  
- **/uploads/** ‚Üí Contient les fichiers upload√©s (organisez par sous-dossiers : `/uploads/file/`, `/uploads/images/` ‚Ä¶).  
- **/cache/** ‚Üí Contient les caches du syst√®me.  


> Vous etes libre de personnaliser vos dossiers , sauf les dossiers ci-haut , cr√©ez autant des dossiers que vous voulez soyez libre , nous vous imposons rien , au cas ou vous voulez que vos dossiers deviennet des parametres du systemes alors ouvrez le fichier config.php ajoutez son chemin comme constante

```php
define('BASE_TEMPLATES','/core/templates');
```

---

## ‚öôÔ∏è Installation

Lorsque vous clonez le projet depuis github , vous ne serez pas obliger d'utiliser les installateurs car ceux-ci sont rarement mis en jour , nous vous recommandons de passer directement a l'etape suivante.


### Via Node.js

Assurez-vous d‚Äôavoir install√© Node.js et ses d√©pendances :

```js
const fs = require('fs');
const path = require('path');
const readline = require('readline');
```

Puis lancez :

```bash
node install.js
```

### Via Python 3

Assurez-vous d‚Äôavoir Python 3 et ces d√©pendances :

```python
import os
import re
import datetime
import sys
```

Puis lancez :

```bash
python3 install.py
```

---

## üåê Gestion des routes

Les routes API sont automatiquement g√©r√©es.  
Exemple : route `/api/test`  

Cr√©ez simplement un dossier `test` dans `/core/routes/` ou `core/versions/VOTRE_VERSION/` avec vos fichiers PHP.

‚úÖ **Chargement automatique de tous les fichiers** : Le routeur charge automatiquement TOUS les fichiers `.php` pr√©sents dans le dossier de la route :
- `functions.php` est charg√© en premier (si pr√©sent)
- Les autres fichiers sont charg√©s par ordre alphab√©tique
- `index.php` est charg√© en dernier

‚ö†Ô∏è Inutile d'inclure `loader.php` et `config.php`, le routeur s'en charge d√©j√†.  

> StructureOne g√®re automatiquement le chargement de tous vos fichiers, plus besoin de les inclure manuellement !

### üö´ Variables r√©serv√©es - IMPORTANT

Pour √©viter les conflits, **n'utilisez JAMAIS** les variables suivantes dans vos routes :
- Toutes les variables pr√©fix√©es par `$_so_` (r√©serv√©es au syst√®me)
- `$GLOBALS['JWT_HTTP_TOKEN']` (√† lire uniquement, ne pas √©craser)

**‚úÖ Bonnes pratiques de nommage :**
```php
// ‚úÖ BON - Noms descriptifs et contextualis√©s
$userData = $_POST['data'];
$dbResult = db_find(...);
$apiResponseData = [...];

// ‚ùå MAUVAIS - Noms trop g√©n√©riques ou r√©serv√©s
$data = $_POST['data'];
$_so_routeName = "test"; // INTERDIT !
```

üìö Consultez `/core/routes/exemple_bonnes_pratiques/` pour un exemple complet.

### Exemple de r√©ponse `/api/test` :

```json
{
    "status": "success",
    "message": "L'api fonctionne",
    "role": "cette api n'est qu'un exemple qui va renvoyer les cordonnees du fichier d'env",
    "env": {
        "DB_HOST": "localhost"
    }
}
```
---

## üêõ Gestion des Erreurs

Lorsque vous creez votre  route , n'oubliez pas d'ajouter la fonction `getError()` si vous utilisez une exception , et cela va activer ou desactiver automatiquement les erreurs si vous etes en production.
Sans DEBUG_MODE :

```php

try {
    // Votre code ici 
} catch (Exception $e) {
   // A L'execption 
    echo getError($e);
}

```

Si certains de nos fonctions de base ne tiennent pas a vos besoin comme par exemple la fonction `getError` alors , vous pouvez ajouter cette suite de code :

```php

try{
   // Votre code ici
} catch (Exception $e) {
    // Gestion des erreurs inattendues
    error_log("ERROR TITLE " . $e->getMessage());
    
    $debug_info = null;
    if (env('DEBUG_MODE') === 'true') {
        $debug_info = [
            'error' => $e->getMessage(),
            'file' => $e->getFile(),
            'line' => $e->getLine()
        ];
    }
    
    echo api_response(500, null, $debug_info);
}

```

Les deux codes ci-haut font carrement la meme chose.

## ‚öôÔ∏è Configuration

```php
// .env
DEBUG_MODE=true
API_TOKEN_SECRET=votre_cle_super_secrete
API_TOKEN_EXP=3600
```
---

## üõ†Ô∏è Fonctions globales

Les fonctions globals , sont des fonctions d√©j√† mis en place pour vous aidez √† aller plus vite , vous n'etes pas conditionner de les utiliser , ses fonctions repondent a des besoins varier.


### Renvoyer une reponse a la sortie de votre API

Pour eviter a chaque fois d'ecrire un bloc de code repetif : 

```php
// Exemple de tableau 
$VOTRE_TABLEAU = [
  "status" => "success",
  "message" => "Utilisateur inscrit avec success",
  "data" => ["uid" => 1]
];
// Renvoyer un code 
http_respone_code(200);
// Renvoyer une reponse
echo json_encode($VOTRE_TABLEAU,true);
exit;
```

Ce travail pourrait etre tr√®s fatiguant , surtout lorsque vous avez beaucoup des routes a g√©rez , alors pour ce faire nous avons mis en place une fonction bien speciale , pour resoudre ce probleme.

```php
api_response($status, $message = null, $data = null)
```  

Cette fonction simplifie la sortit des reponses JSON , g√®re les caract√®res pour eviter les erreurs de caracters **Unicode** et bien plus.
Cette fonction prends en entr√© 3 valeurs : 

- `$status` : Il s'agit du status de la reponse , precedement mis dans `http_response_code(200)` , ici ce parametre prends en charge tout type de code d'erreur.
- `$message` : ce parametre est **optionnel** , c'est juste le message qui sortira a la reponse , precedement `Utilisateur inscrit avec success` , ici au cas ou vous mettez rien , il va mettre lui meme la reponse correspondant a l'erreur , par exemple 404 correspond a **Not Found**
- `$data` : Ceci est aussi **optionnel** , prends en entr√© un `string` ou un `tableau` , precedement `"data" => ["uid" => 1]`.

Exemple D'utilisation :

```php
echo api_response(200, "Requ√™te r√©ussie", [
    "token" => "example-token"
]);
```

### Recuperer un element existant dans le fichier d'environnement
Nous avons mis en place une fonction qui permet de recuperer directement un element venant du fichier d'environnement :  

```php
$db_host = env('DB_HOST');
```
 

### Generer un jeton JWT
 
Il existe une fonction pour generer un jeton JWT , fonctionnel , cette fonction prends en entr√© un `string` ou un `tableau`.

```php
<?php
/** Premier cas **/
// G√©n√©ration du token
$userData = [
    'id' => 123,
    'name' => 'John Doe',
    'email' => 'john@example.com'
];
// Va generer un token en fonction du tableau
$token = jwt_generate($userData);

/** Deuxieme cas **/
$id = 1; // Par exemple on suppose que c'est l'id 1 qu'on veux renvoyer en token 
$myToken = jwt_generate($id);
?>
```
> Il est important d'utiliser la meme methode pour decoder votre jeton JWT 

### Verifier et Valider un jeton JWT
- Valide un token JWT existant.  
- V√©rifie rigoureusement l‚Äôexpiration et la validit√© du token.  
- Utilise √©galement `API_TOKEN_SECRET` et `API_TOKEN_EXP`.  

Pour verifier si un token est valide , vous n'aurez qu'a entrer le token :

```php
<?php

// exemple de token 
$token = "eyJ1aWQiOiI4IiwiZXhwIjoxNzU5NDQ2NDY0fQ.NTY2NDc4ZjljMmE4OTEzYzgwZGMyYTM5MjkzODE2YTdiY2QxMWEwNDA2OTRjNjljOGVkM2VmNGQyMGJhYWViNA";

// Decoder 
$decoded = jwt_validate($token);

// Verifier si le token est valide
if($decoded){
  // creer une response a renvoyer dans la requete 
  $response = [
    "jwt_decoded" => $decoded
  ];

  // Renvoyer la reponse (en API)
  echo api_response(200,"Token valide",$response);
}else{
  // LE token est invalide 
  echo api_response(401,"Token Invalide",null);
}
?>
```

  

### üåç Gestion automatique du header `Authorization`  

Dans `config.php`, une variable sp√©ciale est ajout√©e :  

```php
$authHeader = $_SERVER['HTTP_AUTHORIZATION'] ?? '';
$JWT_HTTP_TOKEN = str_replace('Bearer ','',$authHeader);
```

- Cette variable `$JWT_HTTP_TOKEN` contient automatiquement le token transmis dans le header.  
- Pour l‚Äôutiliser dans une fonction :  

```php
function test(){
   global $JWT_HTTP_TOKEN;

   $decoded = jwt_validate($JWT_HTTP_TOKEN);

   if($decoded){
       // Le token est valide
   }else{
       // Le token est invalide
   }
}
```

üëâ Cette pratique rend l‚ÄôAPI **tr√®s s√©curis√©e** et simple √† maintenir. 


### G√©rer les methodes des requetes entrant

Nous avons enormement simplifier les choses en ajoutant des fonctions globaux , pour vous permettre de designer les methodes autoriser dans vos routes.
nous avons ajouter la fonction `require_method()` et `require_method_in`
la premiere fonction prends en charge uniquement une seule methode et la deuxieme peut prendre en charge plusieurs methode.

**EXEMPLE 1:**
```php

/**
 * EXEMPLE 1: M√©thode POST requise
 * Si la m√©thode n'est pas POST, le script s'arr√™te imm√©diatement
 */
require_method('POST');

// Le code suivant ne s'ex√©cutera JAMAIS si la m√©thode n'est pas POST
echo db_escape($_GET['test']); // ‚Üê Jamais ex√©cut√© en cas d'erreur
```
**EXEMPLE 2:**

```php
/**
 * EXEMPLE 2: M√©thodes multiples autoris√©es
 */
require_method_in(['GET', 'POST']);

// Le code suivant ne s'ex√©cutera que si la m√©thode est GET ou POST
$data = $_GET['id'] ?? $_POST['id'] ?? null;
echo api_response(200, "Succ√®s", $data);
```

**EXEMPLE 3:**

```php
/**
 * EXEMPLE 3: Avec r√©ponse d'erreur personnalis√©e
 */
require_method('POST', function() {
    http_response_code(405);
    header('Content-Type: application/json');
    echo json_encode([
        'error' => true,
        'message' => 'M√©thode non autoris√©e pour cette action'
    ]);
    // Pas besoin de exit ici, il est d√©j√† dans la fonction require_method
});

```
#### BASE DES DONNEES : 

Nous avons mis en place un certain nombre des fonctions qui permet d'effectuer des operations SQL (actuellement uniquement MySQL pris en charge).

1.**Rechercher un exemple dans la base des donnees** `db_find()`:

Cette fonction prends en entrer deux elements , la requete SQL comme premier element , puis les elements a verifier comme deuxieme element .

```php
<?php
    // variable 
    $element_a_verifier = "mon_mail"; // dans la colonne *admin_email* dans la table *admin* pour mon cas
    /**
     * 
     * verifier si l'utilisateur existe deja 
     * 
     */
    $admin_exist = db_find("SELECT * FROM admin WHERE admin_email = ?",[
        $element_a_verifier
    ]);

    /**
     * 
     * Verifier si l'admin existe 
     * 
     */
    if($admin_exist){
        /**
         * 
         * Renvoyer une erreur car l'admin existe deja 
         * 
         */
        echo api_response(409,"Cette adresse mail existe deja",null);
        return; // Pour bloquer la suite de l'execution
    }else{
      /** Element existant dans la base des donnees **/
    }
?>
```

2.**Executer la requete SQL** : `db_execute()`

Cette fonction prends en entrer deux , la requete SQL et les donnees e inserer .

```php
<?php
  /**
  * 
  * Creer l'admin :  Adaptez ce code selon votre base des donnees et selon vos besoins
  * 
  */
  db_execute("INSERT INTO admin (admin_name,admin_email,admin_password) VALUES (?,?,?)",[
      $_admin['name'],$_admin['email'],$_admin['password']
  ]);
?>
```

3.**Recuperer le dernier id enregistrer** : `db_last_id()`

Cette operation doit etre traiter apres , une requete SQL comme vous auriez pu le faire d'habitude.

```php
<?php
// Operation SQL recente 
// Recuperer le dernier id
 $_last_id = db_last_id();
?>
```

4.**Hasher le mot de passe** : `db_hash()`

Cette fonction prends en entrer un element *string* puis le convertit en *hash* pour un mot de passe 

```php
<?php
// String 
$password = "hello";
// hasher 
echo db_hash($password);
?>
```

5.**Filtrer les entrees** : `db_escape()`

cette fonction permet de filtrer les entrees pour se proteger contre les attaques XSS

```php
<?php
// Element a filtrer : cas d'une attaque XSS 
$form = "<h1>Mon nom</h1>";
// Affcher l'element filtrer
echo db_escape($form);
?>
```

6.**Verifier un element sur la base des donnees (version courte)** : `db_element_exist()`

Il existe aussi une version plus courte pour verifier l'existance d'un element dans la base des donnees

```php
<?php
/** Verifier la methode autoriser **/
require_method('GET');

/** Verifier si l'adresse mail existe dans la table *admin* , verifier l'element dans la colonne *admin_email* adaptez cela en fonction de vos besoins **/
if(db_element_exist('admin',['admin_email' => 'test@gmail.com'])){
    echo api_response(200,"Utilisateur existe",null);
}else{
    echo api_response(404,"Utilisateur non existant",null);
}

?>
```




> Referez vous a ces exemples de code pour voir comment vous pouvez utilisez ses fonctions.

---

## üîÑ Mise √† jour des routes

Pour ajouter une nouvelle API :  
1. Cr√©ez un dossier dans `/core/routes/` au nom de la route ou dans `/core/versions/VERSION_DE_ROUTE/`.  
2. Ajoutez vos fichiers `index.php` et `functions.php`.  
3. Le syst√®me d√©tectera automatiquement cette route.  

Si la mise √† jour ajoute de nouvelles fonctions globales ou configurations, pensez √† les placer dans :  
- `config.php`  
- `loader.php`  
- `.env` (si n√©cessaire)  

---
## üìö Exemples Complets
### üîê Route d'Authentification
```php
<?php
// /core/routes/auth/login/index.php

require_method('POST');

$input = json_decode(file_get_contents('php://input'), true);

// Validation
if (empty($input['email']) || empty($input['password'])) {
    echo api_response(400, "Email et mot de passe requis");
    exit;
}

// V√©rification des identifiants
$user = db_find("SELECT * FROM users WHERE email = ?", [$input['email']]);

if ($user && password_verify($input['password'], $user['password'])) {
    // G√©n√©ration du token
    $tokenData = [
        'id' => $user['id'],
        'name' => $user['name'],
        'email' => $user['email'],
        'role' => $user['role']
    ];
    
    $token = jwt_generate($tokenData);
    
    echo api_response(200, "Connexion r√©ussie", [
        'user' => $tokenData,
        'token' => $token,
        'expires_in' => 3600
    ]);
} else {
    echo api_response(401, "Identifiants invalides");
}
?>
```

### üìä Route de Dashboard Prot√©g√©e
```php
<?php
// /core/versions/v1/admin/dashboard/index.php

require_method('GET');

// Authentification et r√¥le admin requis


// R√©cup√©ration des statistiques
$stats = [
    'total_users' => db_count("SELECT COUNT(*) FROM users"),
    'active_users' => db_count("SELECT COUNT(*) FROM users WHERE active = 1"),
    'recent_signups' => db_select("SELECT name, email, created_at FROM users ORDER BY created_at DESC LIMIT 5")
];

echo api_response(200, "Dashboard administrateur", [
    'user' => $user,
    'stats' => $stats
]);
?>
```

---

## üß± Syst√®me de Middleware Ultra-Simplifi√© (v2.1.1+)

### üéØ Introduction

StructureOne int√®gre un syst√®me de middleware **r√©volutionnaire** : **UNE SEULE fonction** pour TOUS vos besoins de validation et s√©curit√© !

**üìö Guide Complet :** Consultez [`GUIDE_MIDDLEWARE_COMPLET.md`](GUIDE_MIDDLEWARE_COMPLET.md) pour un cours d√©taill√© avec exemples.

### ‚ö° Usage Ultra-Simple

**Principe :** Une seule fonction `middleware()` g√®re TOUT :

```php
// Validation simple
$data = middleware(['json' => ['email', 'password']]);
if (!$data) exit;

// Complet (auth + rate limit + validation + sanitization)
$data = middleware([
    'rate' => [10, 60],              // Rate limiting
    'auth' => true,                   // Authentification JWT
    'role' => ['admin'],              // Autorisation
    'json' => ['title', 'content'],   // Champs requis
    'sanitize' => ['title' => 'string'], // Nettoyage XSS
    'validate' => function($data) {   // Validation custom
        return strlen($data['title']) >= 3 ? true : "Titre trop court";
    }
]);
if (!$data) exit;
```

**R√©sultat :** Code **70% plus court**, s√©curit√© **maximale** ! ‚ú®

### üìã Options Disponibles

La fonction `middleware()` accepte ces options :

| Option | Type | Description | Exemple |
|--------|------|-------------|---------|
| `json` | `array` | Champs JSON requis | `['email', 'password']` |
| `optional` | `array` | Champs optionnels avec d√©faut | `['remember' => false]` |
| `auth` | `bool` | Authentification JWT requise | `true` |
| `role` | `array` | R√¥les autoris√©s | `['admin', 'moderator']` |
| `rate` | `array` | [max requ√™tes, secondes] | `[10, 60]` = 10/min |
| `sanitize` | `array` | Nettoyage automatique | `['email' => 'email']` |
| `validate` | `callable` | Fonction de validation custom | `function($data) {}` |

### üéØ Exemples d'Utilisation

#### Exemple 1 : Route Publique Simple

```php
<?php
require_method('POST');

// Validation JSON avec rate limit
$data = middleware([
    'rate' => [100, 60],  // 100 requ√™tes/minute
    'json' => ['email', 'message']
]);
if (!$data) exit;

sendContactEmail($data['email'], $data['message']);
echo api_response(200, "Message envoy√©");
?>
```

#### Exemple 2 : Route avec Authentification

```php
<?php
require_method('GET');

// Auth + rate limit
$data = middleware([
    'auth' => true,
    'rate' => [60, 60]
]);
if (!$data) exit;

$user = middleware_auth(); // Donn√©es du token JWT
$profile = getUserProfile($user['id']);
echo api_response(200, "Profil", $profile);
?>
```

#### Exemple 3 : Route Admin Compl√®te

```php
<?php
require_method('POST');

// TOUT : rate limit + auth + role + validation + sanitization
$data = middleware([
    'rate' => [20, 60],
    'auth' => true,
    'role' => ['admin'],
    'json' => ['title', 'content'],
    'sanitize' => [
        'title' => 'string',
        'content' => 'string'
    ],
    'validate' => function($data) {
        if (strlen($data['title']) < 3) {
            return "Titre trop court";
        }
        return true;
    }
]);
if (!$data) exit;

$post = createPost($data);
echo api_response(201, "Post cr√©√©", $post);
?>
```

### ‚ö° Fonctions Raccourcies

Pour les cas simples :

```php
// JSON uniquement
$data = middleware_json(['email', 'password']);

// Auth uniquement
$user = middleware_auth();

// Rate limit uniquement
middleware_rate(60, 60); // 60 requ√™tes/minute
```

### üéì Exemple Complet : Route CRUD Posts

Consultez [`/core/routes/posts/index.php`](core/routes/posts/index.php) pour un exemple complet avec :
- ‚úÖ CRUD complet (GET, POST, PUT, DELETE)
- ‚úÖ Rate limiting adapt√© par m√©thode
- ‚úÖ Authentification
- ‚úÖ Autorisation admin
- ‚úÖ Validation compl√®te
- ‚úÖ Sanitization

### üìö Documentation Compl√®te

**Pour apprendre en d√©tail :**
- **[GUIDE_MIDDLEWARE_COMPLET.md](GUIDE_MIDDLEWARE_COMPLET.md)** - Cours complet sur les middlewares et rate limiting
- **[/core/routes/posts/](core/routes/posts/)** - Exemple CRUD complet

**Le guide couvre :**
- üìñ Qu'est-ce qu'un middleware ? (avec analogies)
- üéØ Pourquoi utiliser des middlewares ?
- ‚ö° Utilisation √©tape par √©tape (7 niveaux)
- üö¶ Rate limiting en d√©tail et son importance
- üé® Patterns courants
- üß™ Tests et debugging
- ‚úÖ Checklist compl√®te

---

## üîç D√©tection Automatique de Conflits (MODE DEBUG)

En mode DEBUG, StructureOne d√©tecte automatiquement les conflits de variables pour vous aider au debugging.

### Activer le Mode DEBUG

```env
# .env
DEBUG_MODE=true
```

### D√©tecter les Conflits

```php
<?php
// Automatique: les conflits sont logg√©s
$conflicts = debug_detect_variable_conflicts();

// Afficher le rapport
debug_show_conflicts_report();

// Voir toutes les variables partag√©es
$vars = debug_get_shared_variables();
print_r($vars);
?>
```

### Utiliser set_safe() pour Pr√©venir les √âcrasements

```php
<?php
// D√©finir une variable
set_safe('userName', 'John'); // ‚úÖ OK

// Tentative d'√©crasement (d√©tect√©e en DEBUG)
set_safe('userName', 'Jane'); // ‚ö†Ô∏è WARNING dans les logs, non √©cras√©

// Forcer l'√©crasement
set_safe('userName', 'Jane', true); // ‚úÖ OK, forc√©
?>
```

### Types de Conflits D√©tect√©s

1. **Noms similaires** (>80% similarit√©)
   - Exemple: `userName` vs `user_name`
   - Risque de confusion

2. **M√™me valeur** (duplication potentielle)
   - Exemple: `$config1 = ['timeout' => 30]` et `$config2 = ['timeout' => 30]`
   - Possible redondance

### Exemple de Log

```
=== CONFLITS DE VARIABLES D√âTECT√âS ===
[similar_names] userName <-> user_name : Noms tr√®s similaires, risque de confusion
[same_value] config <-> settings : M√™me valeur, possible duplication
```

---

## üîß Nouvelles fonctionnalit√©s (v2.1.1+)

### ‚úÖ Chargement automatique de tous les fichiers
**R√âSOLU** ‚úîÔ∏è - Le syst√®me charge maintenant automatiquement TOUS les fichiers PHP d'une route (pas seulement `index.php` et `functions.php`)

### ‚úÖ Variables Partag√©es Ultra Simplifi√©es
**NOUVEAU** ‚ú® - Fonctions `set()` et `get()` pour partager facilement des variables entre fichiers !

**Dans `functions.php` - D√©finir les variables :**
```php
// ‚úÖ ULTRA SIMPLE avec set()
set('name', 'StructureOne');
set('version', '2.1.1');
set('config', ['timeout' => 30, 'retries' => 3]);
```

**Dans `index.php` - Utiliser les variables :**
```php
// ‚úÖ ULTRA SIMPLE avec get()
$name = get('name');
$config = get('config');

echo api_response(200, "Projet: $name", $config);
```

**Fonctions disponibles :**
- `set($nom, $valeur)` - D√©finir une variable partag√©e
- `get($nom, $defaut)` - R√©cup√©rer une variable (avec valeur par d√©faut)
- `has($nom)` - V√©rifier si une variable existe
- `setMany(['nom' => 'valeur', ...])` - D√©finir plusieurs variables

**Exemple complet :**
```php
// core/routes/users/functions.php
<?php
// D√©finir plusieurs variables
set('tableName', 'users');
set('perPage', 20);
setMany([
    'allowedRoles' => ['admin', 'user'],
    'cacheEnabled' => true
]);

// Fonction helper
function users_validate($email) {
    return filter_var($email, FILTER_VALIDATE_EMAIL);
}
?>

// core/routes/users/index.php
<?php
require_method('GET');

try {
    // R√©cup√©rer les variables
    $table = get('tableName');
    $limit = get('perPage');
    $roles = get('allowedRoles', []);
    
    // V√©rifier si une variable existe
    if (has('cacheEnabled')) {
        // Utiliser le cache...
    }
    
    // Utiliser la fonction
    $isValid = users_validate('test@example.com');
    
    $users = db_find("SELECT * FROM {$table} LIMIT ?", [$limit]);
    echo api_response(200, "Users list", $users);
} catch(Exception $e) {
    echo getError($e);
}
?>
```

### ‚úÖ Pages HTML Professionnelles (inspir√©es Laravel/Symfony)
**NOUVEAU** üé® - Interfaces dark mode sobres et √©l√©gantes

**Activer dans `.env` :**
```env
DEBUG_MODE=true              # Activer le mode debug
ERROR_DISPLAY_HTML=true      # Page d'erreur HTML styl√©e
HOMEPAGE_DISPLAY_HTML=true   # Page d'accueil HTML styl√©e
```

**Page d'Accueil (`/`) :**
- Design sobre et professionnel (fond noir pur #000)
- Informations syst√®me (version, debug, serveur)
- Exemples d'utilisation des routes
- Versions API disponibles
- Pas d'animations distrayantes
- 100% Responsive

**Page d'Erreur :**
- Stack trace d√©taill√©e et lisible
- Extrait de code avec ligne d'erreur
- Suggestions de r√©solution
- Informations de debug compl√®tes
- Design coh√©rent avec la homepage

**‚ö†Ô∏è Important :** Les pages HTML ne s'affichent QUE si activ√©es dans `.env`. Sinon, r√©ponse JSON classique.

### ‚úÖ Protection contre les conflits de variables
**R√âSOLU** ‚úîÔ∏è - Toutes les variables syst√®me utilisent maintenant le pr√©fixe `$_so_` pour √©viter les conflits avec vos routes

**Liste des variables syst√®me prot√©g√©es :**
- `$_so_requestUri` - URI de la requ√™te
- `$_so_requestMethod` - M√©thode HTTP
- `$_so_routeName` - Nom de la route
- `$_so_routeInfo` - Informations de version
- `$_so_loadResult` - R√©sultat du chargement
- Et toutes les variables internes du loader

**Comment √©viter les conflits :**
```php
// ‚úÖ BON - Variables descriptives et contextualis√©es
$userData = json_decode(file_get_contents('php://input'), true);
$dbResult = db_find("SELECT * FROM users WHERE id = ?", [$userId]);
$apiResponseData = ['success' => true];

// ‚ùå MAUVAIS - Variables g√©n√©riques qui peuvent causer des probl√®mes
$data = $_POST;
$result = db_find(...);
$response = [];

// ‚ùå INTERDIT - Variables r√©serv√©es au syst√®me
$_so_routeName = "test"; // NE JAMAIS FAIRE √áA !
```

üìö **Exemple complet** : Consultez `/core/routes/exemple_bonnes_pratiques/` pour voir toutes les bonnes pratiques en action.

---

## ‚öôÔ∏è Futures Mises √† Jour

- üß± **Middleware avanc√©** pour la validation et la s√©curit√©  
- üß† **Gestion du cache avec Redis**  
- üê≥ **D√©ploiement simplifi√© avec Docker**  
- üß™ **Tests automatis√©s avec PHPUnit** avec Composer
- üîç **D√©tection automatique des conflits de variables** en mode DEBUG

---

### üë®‚Äçüíª Auteur & Contribution
StructureOne est cr√©√© et maintenu par Exauce Stan Malka (Exauce Malumba) <br>

> Vous pouvez soutenir le createur de ce projet avec un petit caf√© , cela nous encourage enormement a continuer a vous offrir le meilleur de nous
<br>

[![Support via Donation](https://img.shields.io/badge/Donate-Here-ff69b4?logo=heart&style=for-the-badge)](https://jxzmkdpz.mychariow.shop/donation)


üíº Utilis√© en production par :

Kreatyva - Plateforme de cr√©ation digitale
EdithAI_Personal - Assistant IA personnel
Plusieurs Autres projet

üìß Contact : onestepcom00@gmail.com
üêõ Issues & Contributions : Les PR sont les bienvenues !

---

### üìú Licence

Ce projet est distribu√© sous licence **MIT**.


---

*Derni√®re mise √† jour¬†: 22/10/2025*

---

**üìù Changelog v2.1.1+ (31 Octobre 2024):**

**‚ú® Nouvelles Fonctionnalit√©s:**
- `set()` et `get()` - Partage ultra simple de variables entre fichiers
- `has()` - V√©rifier l'existence d'une variable
- `setMany()` - D√©finir plusieurs variables en une fois
- Pages HTML professionnelles dark mode (homepage + error page)
- Design sobre et √©l√©gant inspir√© de Laravel/Symfony
- Activation conditionnelle des pages HTML via `.env`

**üß± Syst√®me de Middleware Avanc√©:**
- `middleware_validate_json()` - Validation automatique JSON avec champs requis/optionnels
- `middleware_require_auth()` - Authentification JWT simplifi√©e
- `middleware_require_role()` - Gestion des permissions et r√¥les
- `middleware_validate_email()` - Validation d'email avec v√©rification DNS
- `middleware_sanitize()` - Nettoyage automatique des donn√©es (XSS, injection)

**üö¶ Rate Limiting Int√©gr√©:**
- `rate_limit()` - Limitation simple par IP (ex: 60 req/min)
- `rate_limit_advanced()` - Configuration personnalis√©e par route
- Headers HTTP standard (X-RateLimit-*, Retry-After)
- Stockage en cache fichier (pas de BDD requise)
- Protection contre brute force et DDoS

**üîç D√©tection Automatique de Conflits (DEBUG):**
- `debug_detect_variable_conflicts()` - D√©tection de noms similaires
- `debug_show_conflicts_report()` - Rapport dans les logs
- `set_safe()` - set() avec avertissement si conflit
- `debug_get_shared_variables()` - Liste toutes les variables partag√©es
- Logs automatiques des conflits potentiels

**üõ°Ô∏è Am√©liorations:**
- Gestion d'erreurs am√©lior√©e avec stack trace compl√®te
- Logging automatique avec timestamps
- Support codes HTTP personnalis√©s (400, 401, 403, 404, 500...)
- `logMessage()` pour logs personnalis√©s
- Protection des variables syst√®me (pr√©fixe `$_so_`)
- loadEnv() appel√© en premier pour garantir disponibilit√© des variables

**üé® Design:**
- Page d'accueil sobre (fond noir #000, pas d'animations)
- Page d'erreur d√©taill√©e avec suggestions
- 100% Responsive (mobile, tablet, desktop)
- Logo uniquement en header (design √©pur√©)

**üìö Documentation:**
- Exemples complets d'utilisation set()/get()
- Guide des bonnes pratiques
- Documentation middlewares compl√®te
- Route d'exemple `/api/exemple_middlewares`
- Documentation .env mise √† jour

*Derni√®re mise √† jour : 31/10/2024*

---
