# ![StructureOne Logo](/core/github_save/logo.png)

# ‚ö° StructureOne - Architecture PHP √âvolutive et Universelle

<p align="center">
  <img src="https://img.shields.io/badge/Version-2.1.0-blueviolet?style=for-the-badge&logo=github" />
  <img src="https://img.shields.io/badge/PHP-7.4%2B-777BB4?style=for-the-badge&logo=php" />
  <img src="https://img.shields.io/badge/MySQL-8.0%2B-4479A1?style=for-the-badge&logo=mysql" />
  <img src="https://img.shields.io/badge/License-MIT-success?style=for-the-badge&logo=open-source-initiative" />
  <img src="https://img.shields.io/badge/API-RESTful-FF6B6B?style=for-the-badge&logo=postman" />
  <img src="https://img.shields.io/badge/Security-JWT-32CD32?style=for-the-badge&logo=auth0" />
  <img src="https://img.shields.io/badge/üèÜ-Meilleur%20Mini%20Framework%20API-orange?style=for-the-badge" />
  <img src="https://img.shields.io/badge/üî•-Class√©%20N¬∞1%20des%20MicroFrameworks-critical?style=for-the-badge" />
</p>


---

## üöÄ Introduction

**StructureOne** est une architecture PHP moderne et universelle, con√ßue pour √™tre **compatible avec n‚Äôimporte quel serveur**, que ce soit **Apache ou Nginx**.  
Gr√¢ce √† sa nouvelle conception, le framework d√©tecte automatiquement l‚Äôenvironnement serveur et s‚Äôadapte sans configuration manuelle.
Cette compatibilit√© universelle a √©t√© d√©velopp√©e pour garantir une **installation fluide, rapide et s√©curis√©e**, quel que soit l‚Äôh√©bergeur ou l‚Äôenvironnement.

---

## ‚ú® Fonctionnalit√©s Cl√©s

- üîß **Versioning d‚ÄôAPI** : support natif pour `/api/v1/`, `/api/v2/`  
- üß† **Compatibilit√© multi-serveurs** : Apache & Nginx  
- üõ°Ô∏è **S√©curit√© avanc√©e** : protection automatique des fichiers sensibles  
- üß© **Syst√®me JWT int√©gr√©** : authentification robuste et simple  
- üß∞ **Gestion des erreurs et du debug** int√©gr√©e  
- ‚ôªÔ∏è **R√©trocompatibilit√© garantie** avec les versions pr√©c√©dentes  

StructureOne vise √† √©voluer continuellement. Pour les utilisateurs en production, chaque mise √† jour restera compatible avec vos versions pr√©c√©dentes, sauf correctifs de s√©curit√© critiques.


---

## üìÇ Structure du projet

Le projet est compos√© de **6 fichiers principaux** et **1 dossier racine**.  

### Fichiers :

- **index.php**  
  G√®re dynamiquement les routes.  
  Ajoutez simplement un dossier dans `/core/routes/NOM_DU_DOSSIER` et le syst√®me appellera automatiquement son code pour g√©rer la route.  
  ‚ûù Aucun besoin de modifier ce fichier.
  ‚ûù Peut desormais prendre en charge des API par version depuis le dossier `/core/versions/v1/NOM_DU_DOSSIER` , la meme logique est garder.

- **config.php**  
  Contient toutes les **configurations globales** et importantes.  
  Utilisez **des constantes** plut√¥t que des variables afin d‚Äô√©viter des conflits.

- **loader.php**  
  Contient toutes les **fonctions globales**.  
  ‚ûù Ajoutez ici vos nouvelles fonctions r√©utilisables (connexion BDD, helpers, etc.).  
  ‚ö†Ô∏è Ne supprimez pas les fonctions par d√©faut sauf en cas de n√©cessit√©.

- **install.py** et **install.js**  
  Scripts d‚Äôinstallation du projet (au choix Python ou Node.js).  
  Une fois l‚Äôinstallation termin√©e, vous pouvez supprimer ces fichiers.

- **.htaccess** ,  **.env** et **nginx.conf.example**  
  - `nginx.conf.example` ‚Üí Crucial car il est le fichier d'example pour la configuration Nginx
  - `.htaccess` ‚Üí Crucial pour la r√©√©criture d‚ÄôURL et la redirection des requ√™tes vers le routeur.  
  - `.env` ‚Üí G√©n√©r√© automatiquement lors de l‚Äôinstallation (contient les configurations sensibles).  

Par defaut vous n'eetes pas obliger d'ajouter la configuration Nginx sauf si cela vous est utile.

> Pour eviter d'exposer votre fichier d'environnement , veuillez ouvrir le fichier du routeur (index.php) puis allez a la ligne 107 , mettez le chemin vers votre nouvelle emplacement du fichier .env

### Dossier `/core/` :

- **/routes/** ‚Üí Contient les dossiers de chaque route API.  
- **/versions** ‚Üí Contient les dossiers par versions des routes , `/versions/NOM_DE_LA_VERSIO/NOM_DE_LA_ROUTE` (ex : `/versions/v1/users_info`)
- **/logs/** ‚Üí Stockage des logs (erreurs, succ√®s, monitoring).  
- **/database/** ‚Üí Contient les fichiers `.sql` ou `.bdd`.  
- **/uploads/** ‚Üí Contient les fichiers upload√©s (organisez par sous-dossiers : `/uploads/file/`, `/uploads/images/` ‚Ä¶).  
- **/cache/** ‚Üí Contient les caches du syst√®me.  


> Vous etes libre de personnaliser vos dossiers , sauf les dossiers ci-haut , cr√©ez autant des dossiers que vous voulez soyez libre , nous vous imposons rien , au cas ou vous voulez que vos dossiers deviennet des parametres du systemes alors ouvrez le fichier config.php ajoutez son chemin comme constante

```php
define('BASE_TEMPLATES','/core/templates');
```

---

## ‚öôÔ∏è Installation

Lorsque vous clonez le projet depuis github , vous ne serez pas obliger d'utiliser les installateurs car ceux-ci sont rarement mis en jour , nous vous recommandons de passer directement a l'etape suivante.

### Via Node.js

Assurez-vous d‚Äôavoir install√© Node.js et ses d√©pendances :

```js
const fs = require('fs');
const path = require('path');
const readline = require('readline');
```

Puis lancez :

```bash
node install.js
```

### Via Python 3

Assurez-vous d‚Äôavoir Python 3 et ces d√©pendances :

```python
import os
import re
import datetime
import sys
```

Puis lancez :

```bash
python3 install.py
```

---

## üåê Gestion des routes

Les routes API sont automatiquement g√©r√©es.  
Exemple : route `/api/test`  

Cr√©ez simplement un dossier `test` dans `/core/routes/` ou `core/versions/VOTRE_VERSION/`avec :

- `index.php` ‚Üí contient le code de l‚ÄôAPI.  
- `functions.php` ‚Üí contient les fonctions utiles appel√©es par `index.php`.  

‚ö†Ô∏è Inutile d‚Äôinclure `loader.php` et `config.php`, le routeur s‚Äôen charge d√©j√†.  

> A La base StructureOne g√®re pour vous les taches plus flemmant , celui d'ajouter manuellement des routes par case .

### Exemple de r√©ponse `/api/test` :

```json
{
    "status": "success",
    "message": "L'api fonctionne",
    "role": "cette api n'est qu'un exemple qui va renvoyer les cordonnees du fichier d'env",
    "env": {
        "DB_HOST": "localhost"
    }
}
```
---

## üêõ Gestion des Erreurs

Lorsque vous creez votre  route , n'oubliez pas d'ajouter la fonction `getError()` si vous utilisez une exception , et cela va activer ou desactiver automatiquement les erreurs si vous etes en production.
Sans DEBUG_MODE :

```php

try {
    // Votre code ici 
} catch (Exception $e) {
   // A L'execption 
    echo getError($e);
}

```

Si certains de nos fonctions de base ne tiennent pas a vos besoin comme par exemple la fonction `getError` alors , vous pouvez ajouter cette suite de code :

```php

try{
   // Votre code ici
} catch (Exception $e) {
    // Gestion des erreurs inattendues
    error_log("ERROR TITLE " . $e->getMessage());
    
    $debug_info = null;
    if (env('DEBUG_MODE') === 'true') {
        $debug_info = [
            'error' => $e->getMessage(),
            'file' => $e->getFile(),
            'line' => $e->getLine()
        ];
    }
    
    echo api_response(500, null, $debug_info);
}

```

Les deux codes ci-haut font carrement la meme chose.

## ‚öôÔ∏è Configuration

```php
// .env
DEBUG_MODE=true
API_TOKEN_SECRET=votre_cle_super_secrete
API_TOKEN_EXP=3600
```
---

## üõ†Ô∏è Fonctions globales

Les fonctions globals , sont des fonctions d√©j√† mis en place pour vous aidez √† aller plus vite , vous n'etes pas conditionner de les utiliser , ses fonctions repondent a des besoins varier.


### Renvoyer une reponse a la sortie de votre API

Pour eviter a chaque fois d'ecrire un bloc de code repetif : 

```php
// Exemple de tableau 
$VOTRE_TABLEAU = [
  "status" => "success",
  "message" => "Utilisateur inscrit avec success",
  "data" => ["uid" => 1]
];
// Renvoyer un code 
http_respone_code(200);
// Renvoyer une reponse
echo json_encode($VOTRE_TABLEAU,true);
exit;
```

Ce travail pourrait etre tr√®s fatiguant , surtout lorsque vous avez beaucoup des routes a g√©rez , alors pour ce faire nous avons mis en place une fonction bien speciale , pour resoudre ce probleme.

```php
api_response($status, $message = null, $data = null)
```  

Cette fonction simplifie la sortit des reponses JSON , g√®re les caract√®res pour eviter les erreurs de caracters **Unicode** et bien plus.
Cette fonction prends en entr√© 3 valeurs : 

- `$status` : Il s'agit du status de la reponse , precedement mis dans `http_response_code(200)` , ici ce parametre prends en charge tout type de code d'erreur.
- `$message` : ce parametre est **optionnel** , c'est juste le message qui sortira a la reponse , precedement `Utilisateur inscrit avec success` , ici au cas ou vous mettez rien , il va mettre lui meme la reponse correspondant a l'erreur , par exemple 404 correspond a **Not Found**
- `$data` : Ceci est aussi **optionnel** , prends en entr√© un `string` ou un `tableau` , precedement `"data" => ["uid" => 1]`.

Exemple D'utilisation :

```php
echo api_response(200, "Requ√™te r√©ussie", [
    "token" => "example-token"
]);
```

### Recuperer un element existant dans le fichier d'environnement
Nous avons mis en place une fonction qui permet de recuperer directement un element venant du fichier d'environnement :  

```php
$db_host = env('DB_HOST');
```
 

### Generer un jeton JWT
 
Il existe une fonction pour generer un jeton JWT , fonctionnel , cette fonction prends en entr√© un `string` ou un `tableau`.

```php
<?php
/** Premier cas **/
// G√©n√©ration du token
$userData = [
    'id' => 123,
    'name' => 'John Doe',
    'email' => 'john@example.com'
];
// Va generer un token en fonction du tableau
$token = jwt_generate($userData);

/** Deuxieme cas **/
$id = 1; // Par exemple on suppose que c'est l'id 1 qu'on veux renvoyer en token 
$myToken = jwt_generate($id);
?>
```
> Il est important d'utiliser la meme methode pour decoder votre jeton JWT 

### Verifier et Valider un jeton JWT
- Valide un token JWT existant.  
- V√©rifie rigoureusement l‚Äôexpiration et la validit√© du token.  
- Utilise √©galement `API_TOKEN_SECRET` et `API_TOKEN_EXP`.  

Pour verifier si un token est valide , vous n'aurez qu'a entrer le token :

```php
<?php

// exemple de token 
$token = "eyJ1aWQiOiI4IiwiZXhwIjoxNzU5NDQ2NDY0fQ.NTY2NDc4ZjljMmE4OTEzYzgwZGMyYTM5MjkzODE2YTdiY2QxMWEwNDA2OTRjNjljOGVkM2VmNGQyMGJhYWViNA";

// Decoder 
$decoded = jwt_validate($token);

// Verifier si le token est valide
if($decoded){
  // creer une response a renvoyer dans la requete 
  $response = [
    "jwt_decoded" => $decoded
  ];

  // Renvoyer la reponse (en API)
  echo api_response(200,"Token valide",$response);
}else{
  // LE token est invalide 
  echo api_response(401,"Token Invalide",null);
}
?>
```

  

### üåç Gestion automatique du header `Authorization`  

Dans `config.php`, une variable sp√©ciale est ajout√©e :  

```php
$authHeader = $_SERVER['HTTP_AUTHORIZATION'] ?? '';
$JWT_HTTP_TOKEN = str_replace('Bearer ','',$authHeader);
```

- Cette variable `$JWT_HTTP_TOKEN` contient automatiquement le token transmis dans le header.  
- Pour l‚Äôutiliser dans une fonction :  

```php
function test(){
   global $JWT_HTTP_TOKEN;

   $decoded = jwt_validate($JWT_HTTP_TOKEN);

   if($decoded){
       // Le token est valide
   }else{
       // Le token est invalide
   }
}
```

üëâ Cette pratique rend l‚ÄôAPI **tr√®s s√©curis√©e** et simple √† maintenir. 


### G√©rer les methodes des requetes entrant

Nous avons enormement simplifier les choses en ajoutant des fonctions globaux , pour vous permettre de designer les methodes autoriser dans vos routes.
nous avons ajouter la fonction `require_method()` et `require_method_in`
la premiere fonction prends en charge uniquement une seule methode et la deuxieme peut prendre en charge plusieurs methode.

**EXEMPLE 1:**
```php

/**
 * EXEMPLE 1: M√©thode POST requise
 * Si la m√©thode n'est pas POST, le script s'arr√™te imm√©diatement
 */
require_method('POST');

// Le code suivant ne s'ex√©cutera JAMAIS si la m√©thode n'est pas POST
echo db_escape($_GET['test']); // ‚Üê Jamais ex√©cut√© en cas d'erreur
```
**EXEMPLE 2:**

```php
/**
 * EXEMPLE 2: M√©thodes multiples autoris√©es
 */
require_method_in(['GET', 'POST']);

// Le code suivant ne s'ex√©cutera que si la m√©thode est GET ou POST
$data = $_GET['id'] ?? $_POST['id'] ?? null;
echo api_response(200, "Succ√®s", $data);
```

**EXEMPLE 3:**

```php
/**
 * EXEMPLE 3: Avec r√©ponse d'erreur personnalis√©e
 */
require_method('POST', function() {
    http_response_code(405);
    header('Content-Type: application/json');
    echo json_encode([
        'error' => true,
        'message' => 'M√©thode non autoris√©e pour cette action'
    ]);
    // Pas besoin de exit ici, il est d√©j√† dans la fonction require_method
});

```
#### BASE DES DONNEES : 

Nous avons mis en place un certain nombre des fonctions qui permet d'effectuer des operations SQL (actuellement uniquement MySQL pris en charge).

1.**Rechercher un exemple dans la base des donnees** `db_find()`:

Cette fonction prends en entrer deux elements , la requete SQL comme premier element , puis les elements a verifier comme deuxieme element .

```php
<?php
    // variable 
    $element_a_verifier = "mon_mail"; // dans la colonne *admin_email* dans la table *admin* pour mon cas
    /**
     * 
     * verifier si l'utilisateur existe deja 
     * 
     */
    $admin_exist = db_find("SELECT * FROM admin WHERE admin_email = ?",[
        $element_a_verifier
    ]);

    /**
     * 
     * Verifier si l'admin existe 
     * 
     */
    if($admin_exist){
        /**
         * 
         * Renvoyer une erreur car l'admin existe deja 
         * 
         */
        echo api_response(409,"Cette adresse mail existe deja",null);
        return; // Pour bloquer la suite de l'execution
    }else{
      /** Element existant dans la base des donnees **/
    }
?>
```

2.**Executer la requete SQL** : `db_execute()`

Cette fonction prends en entrer deux , la requete SQL et les donnees e inserer .

```php
<?php
  /**
  * 
  * Creer l'admin :  Adaptez ce code selon votre base des donnees et selon vos besoins
  * 
  */
  db_execute("INSERT INTO admin (admin_name,admin_email,admin_password) VALUES (?,?,?)",[
      $_admin['name'],$_admin['email'],$_admin['password']
  ]);
?>
```

3.**Recuperer le dernier id enregistrer** : `db_last_id()`

Cette operation doit etre traiter apres , une requete SQL comme vous auriez pu le faire d'habitude.

```php
<?php
// Operation SQL recente 
// Recuperer le dernier id
 $_last_id = db_last_id();
?>
```

4.**Hasher le mot de passe** : `db_hash()`

Cette fonction prends en entrer un element *string* puis le convertit en *hash* pour un mot de passe 

```php
<?php
// String 
$password = "hello";
// hasher 
echo db_hash($password);
?>
```

5.**Filtrer les entrees** : `db_escape()`

cette fonction permet de filtrer les entrees pour se proteger contre les attaques XSS

```php
<?php
// Element a filtrer : cas d'une attaque XSS 
$form = "<h1>Mon nom</h1>";
// Affcher l'element filtrer
echo db_escape($form);
?>
```

6.**Verifier un element sur la base des donnees (version courte)** : `db_element_exist()`

Il existe aussi une version plus courte pour verifier l'existance d'un element dans la base des donnees

```php
<?php
/** Verifier la methode autoriser **/
require_method('GET');

/** Verifier si l'adresse mail existe dans la table *admin* , verifier l'element dans la colonne *admin_email* adaptez cela en fonction de vos besoins **/
if(db_element_exist('admin',['admin_email' => 'test@gmail.com'])){
    echo api_response(200,"Utilisateur existe",null);
}else{
    echo api_response(404,"Utilisateur non existant",null);
}

?>
```




> Referez vous a ces exemples de code pour voir comment vous pouvez utilisez ses fonctions.

---

## üîÑ Mise √† jour des routes

Pour ajouter une nouvelle API :  
1. Cr√©ez un dossier dans `/core/routes/` au nom de la route ou dans `/core/versions/VERSION_DE_ROUTE/`.  
2. Ajoutez vos fichiers `index.php` et `functions.php`.  
3. Le syst√®me d√©tectera automatiquement cette route.  

Si la mise √† jour ajoute de nouvelles fonctions globales ou configurations, pensez √† les placer dans :  
- `config.php`  
- `loader.php`  
- `.env` (si n√©cessaire)  

---
## üìö Exemples Complets
### üîê Route d'Authentification
```php
<?php
// /core/routes/auth/login/index.php

require_method('POST');

$input = json_decode(file_get_contents('php://input'), true);

// Validation
if (empty($input['email']) || empty($input['password'])) {
    echo api_response(400, "Email et mot de passe requis");
    exit;
}

// V√©rification des identifiants
$user = db_find("SELECT * FROM users WHERE email = ?", [$input['email']]);

if ($user && password_verify($input['password'], $user['password'])) {
    // G√©n√©ration du token
    $tokenData = [
        'id' => $user['id'],
        'name' => $user['name'],
        'email' => $user['email'],
        'role' => $user['role']
    ];
    
    $token = jwt_generate($tokenData);
    
    echo api_response(200, "Connexion r√©ussie", [
        'user' => $tokenData,
        'token' => $token,
        'expires_in' => 3600
    ]);
} else {
    echo api_response(401, "Identifiants invalides");
}
?>
```

### üìä Route de Dashboard Prot√©g√©e
```php
<?php
// /core/versions/v1/admin/dashboard/index.php

require_method('GET');

// Authentification et r√¥le admin requis


// R√©cup√©ration des statistiques
$stats = [
    'total_users' => db_count("SELECT COUNT(*) FROM users"),
    'active_users' => db_count("SELECT COUNT(*) FROM users WHERE active = 1"),
    'recent_signups' => db_select("SELECT name, email, created_at FROM users ORDER BY created_at DESC LIMIT 5")
];

echo api_response(200, "Dashboard administrateur", [
    'user' => $user,
    'stats' => $stats
]);
?>
```

---

## ‚öôÔ∏è Futures Mises √† Jour

- ‚ö° **Inclusion automatique** de tous les fichiers de la route  
- üß± **Middleware avanc√©** pour la validation et la s√©curit√©  
- üß† **Gestion du cache avec Redis**  
- üê≥ **D√©ploiement simplifi√© avec Docker**  
- üß™ **Tests automatis√©s avec PHPUnit**  
- üì¶ **Support complet de Composer** pour les d√©pendances externes  

---

### üë®‚Äçüíª Auteur & Contribution
StructureOne est cr√©√© et maintenu par Exauce Stan Malka (Exauce Malumba)

üíº Utilis√© en production par :

Kreatyva - Plateforme de cr√©ation digitale
EdithAI_Personal - Assistant IA personnel
Plusieurs Autres projet

üìß Contact : onestepcom00@gmail.com
üêõ Issues & Contributions : Les PR sont les bienvenues !

---

### üìú Licence

Ce projet est distribu√© sous licence **MIT**.


---

*Derni√®re mise √† jour¬†: 22/10/2025*

---
